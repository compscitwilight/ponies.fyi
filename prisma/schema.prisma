datasource db {
    provider = "postgresql"
}

generator client {
    provider = "prisma-client"
    output   = "../src/generated/"
}

enum PonysonaStatus {
    Pending
    Approved
    Hidden
}

model Profile {
    userId    String   @id
    isAdmin   Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Ponysona {
    id          String         @id @default(uuid())
    slug        String         @unique
    originalId  String? /* used by ponysonas that are derivative forms of another */
    primaryName String
    otherNames  String[]
    description String?
    status      PonysonaStatus @default(Pending)
    locked      Boolean        @default(false)

    tagIds      Int[] /* reference PonysonaTag */
    sources     String[]
    creators    String[]
    colorsName  String[]
    revisions   PonysonaRevision[]
    attributes  PonysonaAppearanceAttribute[]
    derivatives Ponysona[]                    @relation("derivatives")

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    original Ponysona? @relation(name: "derivatives", fields: [originalId], references: [id])
    media    Media[]
}

enum MediaType {
    preview
    mark
    gallery
}

enum MediaStatus {
    pending /* added */
    uploaded /* committed */
    finalized /* pushed */
}

model Media {
    id         String      @id @default(uuid())
    ponysonaId String?
    type       MediaType   @default(gallery)
    status     MediaStatus @default(pending)
    size       String?
    createdAt  DateTime    @default(now())
    updatedAt  DateTime    @updatedAt

    ponysona Ponysona? @relation(fields: [ponysonaId], references: [id])
}

enum BodyPart {
    mane
    tail
    coat
    wings
    horn
    eyes
}

enum Pattern {
    solid
    striped
    streak
    spotted
}

model PonysonaAppearanceAttribute {
    id         String   @id @default(uuid())
    ponysonaId String
    bodyPart   BodyPart
    colors     String[]
    pattern    Pattern  @default(solid)

    ponysona  Ponysona @relation(fields: [ponysonaId], references: [id])
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([ponysonaId, bodyPart])
}

model PonysonaRevision {
    id         String @id @default(uuid())
    ponysonaId String

    diff     Int
    snapshot Json

    createdAt DateTime @default(now())
    ponysona  Ponysona @relation(fields: [ponysonaId], references: [id])
}

enum TagType {
    species
    form
    role
    setting
    genre
    trait
}

model PonysonaTag {
    id   Int     @id @default(autoincrement())
    name String  @unique
    type TagType
}
